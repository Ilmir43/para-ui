# Ядро системы: бизнес- и UX-логика

Документ описывает ключевые сущности и пользовательские сценарии системы планирования, включая задачи, проекты, цели, рутины и привычки. Спецификация фокусируется на ожидаемом поведении и взаимодействиях UI без привязки к реализации.

## 0. Основные сущности и принципы
- **Задача (Task)** — минимальная единица работы.
- **Проект (Project)** — набор связанных задач, ведущих к конкретному результату.
- **Цель (Goal)** — надпроектная цель (квартал, год).
- **Рутина (Routine)** — повторяющаяся последовательность шагов (утро, вечер, еженедельный обзор).
- **Привычка (Habit)** — повторяющееся действие, иногда входящее в рутину.
- **День (Day)** — содержит план дня, задачи на день, ежедневник.
- **Неделя (Week)** — содержит Weekly Reset, Big Rocks и карту недели.

## 1. Задачи: данные и статусы
### 1.1 Поля задачи
Минимальный набор полей:
- `id` — внутренний идентификатор.
- `title` — краткий заголовок.
- `description` — опциональное описание/заметки.
- `projectId` — связь с проектом (опционально).
- `goalId` — связь с целью (опционально).
- `area` — сфера (карьера, здоровье и т.д.).
- `context` — контекст (дом, компьютер, телефон и т.п.).
- `estimatedMinutes` — оценка времени (целое число).
- `timeBucket` — группа длительности: `micro` (до 10 мин), `short` (11–30 мин), `medium` (31–60 мин), `long` (>60 мин).
- `status` — текущее состояние задачи.
- `flags` — набор флагов: `quick`, `frog`, `batchable`, `fear`, `waiting`.
- `createdAt` — дата создания.
- `dueDate` — опциональный срок.
- `plannedDate` — дата, на которую задача запланирована.
- `completedAt` — дата завершения (при наличии).

### 1.2 Статусы задач
- `inbox` — сырая задача без контекста, оценки и связей.
- `clarified` — задача осмыслена (есть оценка, контекст, сфера, опционально проект/цель).
- `next` — готова к выполнению как следующий шаг, но без привязки к дню.
- `planned_today` — выбрана для выполнения сегодня (появляется через Smart Morning Planning).
- `active` — выполняется прямо сейчас (обычно только 0–1 задача).
- `waiting` — блокируется внешним фактором.
- `done` — завершена.
- `someday` — отложена на неопределённый срок.
- `cancelled` — отменена или неактуальна.

### 1.3 Отображение по статусам и флагам
- **Inbox** — задачи со статусом `inbox`.
- **Processing** — перевод `inbox` → `clarified`/`next`/`waiting`/`someday`.
- **Next Actions** — `next` (и часть `clarified`, если подходят).
- **Today** — `planned_today` + `active`.
- **Что зависит от меня** — `next`, `planned_today`, `active`, исключая `waiting`.
- **Жду ответа** — задачи `waiting`.
- **Сделать быстро** — задачи `next`/`planned_today` c `timeBucket = micro` и `flags.quick = true`.
- **Frogs List** — задачи с флагом `frog`.

### 1.4 Цветовые индикаторы длительности
- `micro` — светло-зелёный, быстрые задачи (до 10 мин).
- `short` — нейтральный/серый (11–30 мин).
- `medium` — жёлтый (31–60 мин), «небольшой блок работы».
- `long` — красный (>60 мин) с явным предупреждением: «Эта задача крупная, стоит разбить её на несколько шагов».

## 2. GTD Processing Engine (разбор Inbox)
### 2.1 Назначение
Обеспечить быстрый поштучный разбор новых задач из `inbox` в осмысленные статусы и списки.

### 2.2 Поток обработки
1. **Вход:** пользователь открывает экран Inbox и запускает режим «Разбор».
2. **Подача задач:** система показывает карточку очередной `inbox` задачи (заголовок, заметка/контекст, источник).
3. **Вопросы при разборе:**
   - «Это вообще задача/действие?» — если нет: превратить в заметку/удалить/архивировать.
   - «Могу ли я сделать это за 10 минут или меньше?» — при `да` ставятся `timeBucket = micro`, `flags.quick = true`.
   - «Нужно ли это делать именно мне?» — если нет: перевести в `waiting` или `delegated`.
   - «К какому проекту относится?» — выбор/создание проекта.
   - «Какая сфера (area)?» — выбор сферы.
   - «Какой контекст?» — дом/ПК/телефон/улица и т.п.
   - «Сколько времени займёт?» — 5/10/15/25/45/60+ минут.
4. **Результат разбора:**
   - Не задача → `cancelled` или заметка.
   - Зависит от других → `waiting`.
   - «Когда-нибудь» → `someday`.
   - Быстрая задача → флаг `quick` + `timeBucket = micro`.
   - По умолчанию → `clarified` или сразу `next`.
5. **Маршрутизация:** задача автоматически попадает в соответствующие списки/блоки (быстрые, waiting, next, Today) и исчезает из экрана обработки.

## 3. Task Life Cycle (жизненный цикл)
- `inbox → clarified` (после разбора).
- `clarified → next` (одобрено как следующий шаг).
- `next → planned_today` (попала в план дня через Smart Morning Planning).
- `planned_today → active` (выбрана для работы сейчас).
- `active → done` (завершена).
- Любой статус → `waiting`, `someday` или `cancelled` по необходимости.

### 3.2 Fear Detector
- Флаг `flags.fear = true`, если задача трижды переносилась по дням или провела в `next` более N дней (примерно 7).
- UI показывает метку избегания с предложением упростить задачу, разбить на шаги, превратить в `frog` или отменить.

## 4. Сегодня: Smart Morning Planning и Today Screen
### 4.1 Smart Morning Planning
Мастер планирования дня:
1. **Daily Priority:** выбрать приоритетную задачу из `next` (важные проекты/цели). Ставит `status = planned_today` и `dailyPriority = true`.
2. **Supporting tasks:** выбрать 2–5 задач `next` (фильтр по времени/энергии). Всем ставится `status = planned_today`.
3. **Баланс по времени:** суммировать оценку задач `planned_today`, сравнить с лимитом (3–4 часа). При превышении предупредить и предложить снять задачи обратно в `next`.

### 4.2 Экран Today
Секции:
- **Daily Priority** — крупный блок с кнопкой «Перейти к фокусу» (Dead Simple Mode).
- **Фокус-задачи** — задачи `planned_today`, сортировка: сначала `frog`, затем по времени.
- **Сделать быстро** — блок быстрых задач.
- **Лягушки (Frogs)** — отдельная секция (1–3 задачи).
- **Жду ответа** — блок `waiting`, относящийся к текущему дню.

Действия: клик по задаче открывает детали или запускает Dead Simple Mode; отметка «готово» переводит в `done`.

## 5. Dead Simple Mode (режим одной задачи)
- Вызов из Today или карточки проекта.
- Экран: крупный заголовок задачи, блок «зачем это важно», таймер (25/50 мин), кнопки «Старт/Пауза», «Готово», «Отложить».
- Действия: «Готово» → `done`; «Отложить» оставляет `planned_today` и может привести к метке `fear` при повторных откладываниях.

## 6. Project Engine
### 6.1 Структура проекта
- Поля: `id`, `title`, `description`, `goalId`, `area`, `status` (`active`/`paused`/`done`), `progress`, ссылки на задачи, список micro-milestones.

### 6.2 Smart Project Start
Мастер при создании проекта:
1. Название проекта.
2. Зачем он нужен.
3. Критерий завершения.
4. Первые три шага (создание трёх задач).

Результат: карточка проекта, первые задачи, при необходимости новая цель.

### 6.3 Next Step
- У активного проекта должен быть один `isNextStep = true`.
- Если следующего шага нет, в карточке проекта предупреждение: «Нет следующего шага. Добавь простой следующий шаг.»
- Просмотр проекта: блок «Следующий шаг» сверху + список задач.

### 6.4 Micro-milestones
- Ручные этапы с названием, вкладом (%) и опциональными задачами.
- На экране проекта — визуальная полоска прогресса с отмеченными этапами.

## 7. Routine Engine
### 7.1 Определение рутины
Рутина — последовательность шагов, объединённых по сценарию (утро, вечер, рабочий старт, еженедельный обзор). Шаг может быть задачей/привычкой/напоминанием, иметь оценку времени и микро-версию.

### 7.2 Routine Manager
- Экран управления: список рутин (карточки с названием, типом, частотой), действия «Редактировать», «Выполнить сейчас», «Копировать».
- Редактор шага: название, привязка к задаче/привычке, пример длительности, флаг «микро-версия», управление порядком шагов.

### 7.3 Routine Stack
- Возможность запускать цепочки рутин (физическая, умственная, эмоциональная и т.п.).
- UI: панель с чеклистом, отметка шагов по порядку, прогресс рутины.

## 8. Weekly Reset (еженедельный обзор)
Шаги мастера:
1. **Inbox Zero** — разобрать все `inbox` задачи через Processing.
2. **Жду ответа** — пересмотреть `waiting`: оставить, закрыть или обновить.
3. **Ревью проектов** — отметить статус активных проектов (двигается/стоп/завершён), добавить/обновить следующий шаг, при необходимости `paused`/`done`.
4. **Цели и Big Rocks** — выбрать 1–3 большие камня на неделю, связать с проектами/целями.
5. **Карта недели** — разложить большие/средние/мелкие задачи по дням недели (без жёсткого расписания).

Результат: актуальные статусы проектов, список `next` действий, обновлённая структура недели.

## 9. Habit Engine
### 9.1 Структура привычки
- Поля: `id`, `title`, `area`, привязка к рутине (опционально), частота (каждый день/будни/N раз в неделю), `level`, `microVersion`, `streak`, история выполнения.

### 9.2 Habit Builder
Мастер создания привычки: название → частота → минимальный формат (micro-версия) → привязка к сфере/рутине. Результат — привычка появляется в соответствующей рутине и в списке привычек дня.

### 9.3 Habit Failure Detector
- Если привычка пропущена N раз подряд (≈3), система предлагает упростить (micro-версия), изменить частоту, привязать к другой рутине или временно отключить.
- UI отображает сигнал: «Эта привычка не выполняется. Упростить её?»

## 10. Reset Protocol
Триггеры: множество невыполненных `planned_today`, «протухшие» `next`, систематически невыполняемые рутины, перегруз планом.

Действия: панель с вариантами «Упростить день» (убрать задачи из Today), «Вернуться к Dead Simple Mode», «Пересобрать рутины» (Routine Manager), «Запустить Weekly Reset (раньше срока)».

## 11. Общая картина UI
Основные экраны:
1. **Dashboard** — Daily Priority, план дня, быстрые задачи, маленькие победы.
2. **Inbox / Processing** — список необработанных задач и режим поштучного разбора.
3. **Today / Week** — список задач на сегодня и карта недели.
4. **Projects** — список проектов, экран проекта (Smart Start, Next Step, milestones).
5. **Routines & Habits** — список рутин, выполнение/редактирование, привычки.
6. **Weekly Reset** — мастер еженедельного обзора.
7. **Focus (Dead Simple Mode)** — одна задача на полный экран.
